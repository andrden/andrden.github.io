<!doctype html>
<html>
<head>
    <meta charset="utf8">
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>

    <script>
        // https://www.naishare.com/blog/getting-started-with-firebase-realtime-database-on-the-web

        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyBzdDMv71fEwZzAZW6ATevAT9TWMbRveZg",
            authDomain: "app1-cfe36.firebaseapp.com",
            databaseURL: "https://app1-cfe36-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "app1-cfe36",
            storageBucket: "app1-cfe36.appspot.com",
            messagingSenderId: "1062099327891",
            appId: "1:1062099327891:web:582571408d3e4ed463a666"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const writeToDatabase = () => {
            let txtIn = document.getElementById('txtIn')
            let txt = txtIn.value
            txtIn.value = ''
            firebase.database().ref("Registration/aaa").set({
                name: 't ' + Date.now(),
                user: document.getElementById('user').value,
                msg: txt,
            });
        };

        function readFromDatabaseOn() {
            firebase.database().ref("Registration/aaa")
                .on("value", function (snapshot) {
                    console.log(snapshot.val().name);
                    console.log(snapshot.val().user);
                    console.log(snapshot.val().gender);
                    console.log(snapshot.val().msg);
                    document.getElementById('txtOut').innerText += '\nFrom ' + snapshot.val().user + ": " + snapshot.val().msg;
                });
        }

        readFromDatabaseOn()
        let mediaRecorder;

        async function startRecording() {
            let stream = await navigator.mediaDevices.getUserMedia({audio: true, video: false});
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.addEventListener('dataavailable', (e) => {
                console.log('mediaRecorder dataavailable ', e)
                firebase.database().ref("Registration/aaa").set({
                    name: 't ' + Date.now(),
                    user: document.getElementById('user').value,
                    aud: e.data,
                });
            })
            mediaRecorder.start()
        }

    </script>
</head>
<body>
<h1>Page 3 - simple chat using Firebase realtime DB server</h1>
<label for="user">Choose a user name:</label><input id="user"/>
<br/>
<label for="txtIn">Input message:</label><input id="txtIn"/>
or
<button onmousedown="startRecording()" onmouseup="mediaRecorder.stop()">Record</button>
<button onclick="writeToDatabase()">Write (everyone will see this message)</button>
<br/>
<br/>
<br/>
<br/>
<br/>
From server:
<pre id="txtOut" style="width: 100%; border: 2px dotted blue">...message...</pre>
</body>
</html>
